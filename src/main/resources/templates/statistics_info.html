<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>统计信息</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link href="//dream.picp.vip/static/admin/css/bootstrap.min.css?v=3.3.6" rel="stylesheet" />
    <link href="//dream.picp.vip/static/admin/css/font-awesome.css?v=4.4.0" rel="stylesheet" />
    <link href="//dream.picp.vip/static/admin/css/plugins/bootstrap-table/bootstrap-table.min.css" rel="stylesheet" />
    <link href="//dream.picp.vip/static/admin/css/animate.css" rel="stylesheet" />
    <link href="//dream.picp.vip/static/admin/css/style.css?v=4.1.0" rel="stylesheet" />
</head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">
    <!-- Panel Other -->

    <!-- End Panel Other -->
</div>
<!-- 全局js -->
<script src="//dream.picp.vip/static/admin/js/jquery.min.js?v=2.1.4"></script>
<script src="//dream.picp.vip/static/admin/js/bootstrap.min.js?v=3.3.6"></script>
<!-- 自定义js -->
<script src="//dream.picp.vip/static/admin/js/content.js?v=1.0.0"></script>
<script src="//dream.picp.vip/static/common/js/common.js?v=1.0.0"></script>
<!-- Bootstrap table -->
<script src="//dream.picp.vip/static/admin/js/plugins/bootstrap-table/bootstrap-table.min.js?v=1.9.0"></script>
<script src="//dream.picp.vip/static/admin/js/plugins/bootstrap-table/bootstrap-table-mobile.min.js?v=1.9.0"></script>
<script src="//dream.picp.vip/static/admin/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js?v=1.0.0"></script>
<!-- layer 弹框 -->
<script src="//dream.picp.vip/static/layer/dist/layer.js?v=1.0.0"></script>
<!-- Peity -->
<script>
    $(function() {

        $("#price").on("blur", function () {
            var price= $(this).val();
            $("#price").val(price.toFixed(2));
        });

        $('#exampleTableEvents').bootstrapTable({
            url: "queryProductList",
            search: false,
            striped: true,
            pagination: true,
            showRefresh: true,
            showToggle: true,
            showColumns: true,
            dataType: "json",
            iconSize: 'outline',
            cache: false,
            toolbar: '#exampleTableEventsToolbar',
            icons: {
                refresh: 'glyphicon-repeat',
                toggle: 'glyphicon-list-alt',
                columns: 'glyphicon-list'
            },
            sidePagination: "server",
            columns: [
                {field:"id",title:"产品编号",align: 'center', valign: 'middle',data:"id"},
                {field:"productTypeName",title:"部门",align: 'center', valign: 'middle',data:"no"},
                {field:"name",title:"产品名称",align: 'center', valign: 'middle',data:"name"},
                {field:"unit",title:"单位",align: 'center', valign: 'middle',data:"unit"},
                {field:"specification",title:"规格",align: 'center', valign: 'middle',data:"specification"},
                {field:"price",title:"价格",align: 'center', valign: 'middle',data:"price",
                    formatter:function (value, row, index) {
                        return [row.price.toFixed(2)].join("");
                    }
                },
                {field:"opt",title:"操作",align: 'center', valign: 'middle',data:"opt",
                    formatter:function (value, row, index) {
                        return ['<button type="button" class="delProduct btn btn-danger btn-xs" userId="'+row.id+'"><i class="glyphicon glyphicon-trash" aria-hidden="true"></i> 删除</button>'].join("");
                    },
                    events: {"click .delProduct":function (e, value, row, index) {
                            layer.open({
                                title:"删除前的确认",
                                content:"确定删除<font color='red'>"+row.name+"</font>（<font color='red'>"+row.id+"</font>）？",
                                btn:["确定","取消"],
                                btn1:function (index) {
                                    //开始执行删除操作
                                    var ajaxObj = {url: 'del',param:{"id":row.id},method:"GET",async:false};
                                    commonJS.sendAjaxRequest(ajaxObj, function (value) {
                                        if(value.data==true){
                                            layer.alert("删除成功！");
                                        } else {
                                            layer.alert("删除<font color='red'>"+row.name+"</font>（<font color='red'>"+row.id+"</font>）失败！");
                                        }
                                    });
                                    window.location.reload();
                                },
                                btn2:function (index) {
                                    layer.close(index);
                                }
                            });
                        }}
                }
            ]
        });

        $("#add").on("click", function () {
            layer.open({
                title: "新增产品",
                type: 1,
                skin: 'layui-layer-rim', //加上边框
                area: ['580px', '400px'], //宽高
                content: $("#addProduct"),
                btn: ['确定','取消'],
                btn1: function (index) {
                    var name = $("#name").val();
                    if(name==null || name=="" || name==undefined){
                        layer.msg("品名不能为空！");
                        return;
                    }
                    var unit = $("#unit").val();
                    if(unit==null || unit=="" || unit==undefined){
                        layer.msg("单位不能为空！");
                        return;
                    }
                    var specification = $("#specification").val();
                    if(specification==null || specification=="" || specification==undefined){
                        layer.msg("规格不能为空！");
                        return;
                    }
                    var price = $("#price").val();
                    if(price==null || price=="" || price==undefined){
                        layer.msg("价格不能为空！");
                        return;
                    }
                    var no = $("#no").val();
                    var param = {
                        no: no,
                        name: name,
                        unit: unit,
                        specification: specification,
                        price: price
                    };
                    var ajaxObj = {url: 'add',param:param,method:"POST",async:false};
                    commonJS.sendAjaxRequest(ajaxObj, function (data) {
                        if(data.data==true){
                            layer.msg('新增产品成功！');
                        } else {
                            layer.msg("新增产品失败！")
                        }
                        layer.close(index);
                        window.location.reload();
                    });
                },
                btn2: function (index) {
                    layer.close(index);
                }
            });
        });

    });
</script>
</body>
</html>
